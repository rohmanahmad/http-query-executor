{"code":"(window.webpackJsonp=window.webpackJsonp||[]).push([[55],{88:function(t,e,i){\"use strict\";i.r(e);var n=i(0);i(19);i(1).tag2(\"shareofvoicesentiment\",'<div class=\"widget-1\"> <div class=\"card shadow-base overflow-hidden\"> <div class=\"card-header bb-1\"> <h6 class=\"card-title\"> <img src=\"assets/img/image/pie-chart-teal.png\" width=\"20\" height=\"20\" class=\"mg-r-5\"> SHARE OF SENTIMENT</h6> <span> <img src=\"assets/img/image/dowload-teal.png\" width=\"20\" height=\"20\" class=\"mg-r-10 cursor-pointer \" data-toggle=\"tooltip\" data-placement=\"top\" title=\"Download\" onclick=\"{downloadcsv}\"> <span class=\"cursor-default\" aria-hidden=\"true\" data-toggle=\"tooltip\" data-placement=\"top\" title=\"Comparison of the total mention about your project to other project of your choosing\">?</span> </span> </div> <div class=\"ripple-loader\" if=\"{isLoading}\"></div> <div class=\"card-body pd-0 bd-color-gray-lighter textcenter mg-t-20 height280\" if=\"{notdata}\"> <div calss=\"textcenter mg-t-20\">No data found, please input another dates</div> </div> <div class=\"card-body pd-10 bd-color-gray-lighter height300 \" id=\"shareofvoicesentiment\" if=\"{!notdata}\"> </div> </div> </div>',\"\",\"\",(function(t){this.chartreemp=null,this.isLoading=!0,this.notdata=!1,this.isExist=!0,this.xhr=null,this.data={},this.render=t=>{APP.apiGet({path:\"projects/list\",data:{selected_fields:\"key_id,key_name\"},success:e=>{this.dataproject=e,setTimeout(()=>{let i=Object(n.clone)(this.parent.search);i.section?this.searchsection=i.section:this.searchsection=\"positive,negative,neutral\",this.renderdata(e),Object(n.isFunction)(t)&&t()},1e3),this.update()}})};var e=this;this.renderdata=t=>{this.update({isLoading:!0}),APP.log(\"sentiment : update data\"),async.parallel({positive:function(t){i((function(e){t(null,e)}),\"positive\")},negative:function(t){i((function(e){t(null,e)}),\"negative\")},neutral:function(t){i((function(e){t(null,e)}),\"neutral\")}},(e,i)=>{this.update({isLoading:!1,nodata:!1}),this.mapData(i,t)})},this.generateData=t=>{let e=[];Object(n.each)(Object(n.groupBy)(t,\"brand_name\"),(t,i)=>{let a=Object(n.sumBy)(t,\"count\"),s={};return s[i]=a,e.push(s)})},this.mapData=(t,e)=>{if(t){let i=t.positive,n=t.negative,s=t.neutral;\"positive\"==this.searchsection?(i=t.positive,n=[],s=[]):\"negative\"==this.searchsection?(i=[],n=t.negative,s=[]):\"neutral\"==this.searchsection?(i=[],n=[],s=t.neutral):\"neutral,positive\"==this.searchsection||\"positive,neutral\"==this.searchsection?(i=t.positive,n=[],s=t.neutral):\"neutral,negative\"==this.searchsection||\"negative,neutral\"==this.searchsection?(i=[],n=t.negative,s=t.neutral):\"positive,negative\"!=this.searchsection&&\"negative,positive\"!=this.searchsection||(i=t.positive,n=t.negative,s=[]);let o={positive:{},negative:{},neutral:{}};const r={};for(let t in i){const e=i[t].brand_name;o.positive[e]||(o.positive[e]=0),o.positive[e]=o.positive[e]+i[t].count,r[e]||(r[e]=0),r[e]+=i[t].count}for(let t in n){const e=n[t].brand_name;o.negative[e]||(o.negative[e]=0),o.negative[e]=o.negative[e]+n[t].count,r[e]||(r[e]=0),r[e]+=n[t].count}for(let t in s){const e=s[t].brand_name;o.neutral[e]||(o.neutral[e]=0),o.neutral[e]=o.neutral[e]+s[t].count,r[e]||(r[e]=0),r[e]+=s[t].count}this.items=o;const c=p(\"project\"),l=document.projectCompetition?document.projectCompetition:\"\",h=decodeURIComponent(`${c},${l}`),d=e,u=(\"string\"==typeof h?h.split(\",\").map(t=>t.trim()).filter(t=>\"\"!==t).toString():\"\").split(\",\").map(t=>parseInt(t.trim())),v=d.filter(t=>u.indexOf(t.key_id)>=0).map(t=>t.key_name),g=this.searchsection.split(\",\");let m={};for(let t in g){const e=g[t];m[e]=[];for(let t in v){const i=v[t];o[e]||(o[e]={}),o[e][i]||(o[e][i]=0);r[i];const n=o[e][i];m[e].push(n)}}a(m,v,r)}};var i=(t,e)=>{let i=Object(n.clone)(this.parent.search);i.section=e,APP.apiGet({path:\"stream/brand/mention\",data:i,success:e=>{t(e.items)}})},a=(t,i,a)=>{var s={positive:\"#6cb17d\",negative:\"#d74943\",neutral:\"#ffb848\"};i.map(t=>a[t]);var o=Object(n.map)(t,(t,e)=>({name:e,color:s[e],data:t}));this.update({isLoading:!1}),Highcharts.chart(\"shareofvoicesentiment\",{chart:{type:\"bar\",margin:[20,60]},title:{text:\"\"},xAxis:{categories:i,crosshair:!0,labels:{style:{color:\"#333\",font:\"12px Trebuchet MS, Verdana, sans-serif\",fontWeight:\"bold\"},formatter:function(){return this.value.length>15?this.value.substr(0,15)+\"...\":this.value}}},yAxis:{min:0,labels:{formatter:function(t){return numeral(null!==this.value?this.value:\"0\").format(\"0.00 a\").replace(\".00\",\"\")},style:{color:\"#333\",font:\"12px Trebuchet MS, Verdana, sans-serif\",fontWeight:\"bold\"}},title:{text:\"\"}},tooltip:{enabled:!1},credits:{enabled:!1},navigation:{buttonOptions:{enabled:!1}},legend:{enabled:!0,itemStyle:{color:\"#33333\",fontSize:\"12px\"}},plotOptions:{series:{dataLabels:{enabled:!0,useHTML:!0,formatter:function(){const t=a[this.x],e=(100*this.y/t).formatMoney(1);return\"<span style='z-index:0;position:relative; font-size:12px;'> \"+this.y.formatMoney(0)+`(${e}%)</span>`}},maxPointWidth:100,minPointLength:20,cursor:\"pointer\",events:{click:function(t){var i=JSON.parse(localStorage.projects),a=Object(n.filter)(i,(e,i)=>e.key_name==t.point.category),s=a?a[0].key_id:\"\";e.parent.detailmentions(null,t.point.series.name,null,null,null,null,t.point.category,s)}}},column:{stacking:\"percent\",pointPadding:.2,borderWidth:0}},series:o})};this.downloadcsv=()=>{let t={};t.positive=this.items.positive,t.negative=this.items.negative,t.neutral=this.items.neutral;const e=Object.keys(t.positive).map(t=>t);let i=[];for(const n in t){let a={sentiment:n};for(const i of e)a[i]=t[n][i];i.push(a)}i.length>0&&APP.downloadcsv(i,\"share_of_voice_competition_\"+p(\"project\").replace(/,/g,\"_\"),!0)},this.on(\"mount\",()=>{this.xhr=null}),this.on(\"unmount\",()=>{this.isExist=!1,this.xhr&&this.xhr.abort(),this.chartreemp&&this.chartreemp.spacing&&this.chartreemp.destroy()})}))}}]);","extractedComments":[]}