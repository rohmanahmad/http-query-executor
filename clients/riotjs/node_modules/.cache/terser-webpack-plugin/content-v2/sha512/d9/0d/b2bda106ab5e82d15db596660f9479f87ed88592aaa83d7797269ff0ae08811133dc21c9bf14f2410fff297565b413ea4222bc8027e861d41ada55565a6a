{"code":"(window.webpackJsonp=window.webpackJsonp||[]).push([[90],{218:function(t,e,i){\"use strict\";i.r(e);var s=i(0);i(5),i(15),i(16),i(9),i(8),i(46),i(10),i(35),i(47),i(2),i(19);i(1).tag2(\"dashboarmentions\",'<breadcrumb current=\"Dashboard Mentions\" ref=\"breadcrumb\" mode=\"project\"></breadcrumb> <div class=\"br-pagebody pd-x-20 pd-sm-x-30\"> <div class=\"row\"> <div class=\"col-md-12\"> <div class=\"widget-2\"> <div class=\"card shadow-base overflow-hidden\"> <div class=\"card-header borderbottom0\"> <div class=\"media-body mg-t-10\"> <h4 class=\"tx-normal tx-roboto tx-inverse mg-b-5\">STREAMS MENTIONS</h4> </div> <group-competitive></group-competitive> <button onclick=\"{downloadStreams}\" class=\"{isExportActive ? \\'btn-outline-light\\' :\\'cursor-pointer btn-outline-primary \\'} btn btn-block mg-b-0 mg-t-0 mg-r-10 mg-t-0-r10 width100 mobilesbutton mgt-mobile-max-415\" 2> <i if=\"{isExportActive}\" class=\"fa fa-spinner fa-spin mg-r-10\"></i> Export </button> </group-competitive> <div class=\"btn-group pull-right mg-r-m-0\" role=\"group\" aria-label=\"Basic example\"> <div class=\"pd-x-25 tx-11 pd-y-12 tx-mont tx-medium datepickerbacgraoud\"> <span> <date-picker cb=\"{updateDate}\" since=\"{localStorage.since}\" until=\"{localStorage.until}\" class=\"fc-datepicker btn bg-grey-50 padding-10-20 no-border color-grey-600 pull-right date-style \" style=\"padding:0px\"></date-picker></span> </div> </div> </div> </div> </div> </div> </div> <chart-stream-metions ref=\"chartstream\"></chart-stream-metions> <div class=\"row row-sm\"> <div class=\"col-md-8 mg-t-10 pd-r-0\" id=\"channels\"> <channel cb=\"{updateChannel}\" ref=\"channel\"></channel> </div> <div class=\"col-md-4 mg-t-10 pd-r-0\" id=\"sentiment\"> <sentiment cb=\"{updateSentiment}\" ref=\"sentiment\"></sentiment> </div> </div> <div class=\"row row-sm\"> <div class=\"col-md-4 mg-t-20 showmax500\"> <filter calss=\"showmax500\" namefilter=\"true\" ref=\"filtervalmobile\"></filter> </div> <div class=\"col-md-8 mg-t-20\" id=\"maxfollowscroll\"> <stream-timeline ref=\"streamTimeline\" corection=\"false\"></stream-timeline> </div> <div class=\"col-md-4 mg-t-20 hiddenmax500\"> <filter namefilter=\"true\" ref=\"filterval\"></filter> </div> </div> <footer class=\"br-footer\"> <div class=\"footer-left\"> </div> <div class=\"footer-right d-flex align-items-center\"> </div> </footer> <a href=\"javascript:\" id=\"return-to-top\" onclick=\"{scrolltop}\"><i class=\"fa fa-chevron-up\"></i></a> </div> <div id=\"modaldemo3\" class=\"modal fade show\"> <div class=\"modal-dialog modal-lg wd-40p\" role=\"document\"> <form id=\"myFormid\" method=\"get\" onsubmit=\"{savefilterBookmart}\"> <div class=\"modal-content tx-size-sm\"> <div class=\"card-body pd-t-20 pd-r-20 pd-l-20 pd-0 mg-b-20\"> <div class=\"row mg-b-20\"> <div class=\"col-sm-12 mg-t-10 mg-sm-t-0 text-center\">Give this a filter name</div> </div> <div class=\"row\"> <div class=\"col-sm-12 mg-t-10 mg-sm-t-0\"> <input type=\"text\" id=\"inputfocusnamevalue\" name=\"inputfokus\" class=\"form-control\" placeholder=\"\" ref=\"nameFilterValue\"> <p class=\"pd-0 mg-b-0\" if=\"{!error}\">&nbsp;</p> <p class=\"pd-0 mg-b-0 colorred\" if=\"{error}\">This value is required.</p> </div> </div> </div> <div class=\"modal-footer d-block pd-0\"> <div class=\"row\"> <div class=\"col-md-6 pd-r-0\"> <button type=\"button\" class=\"btn btn-outline-secondary wd-100-color-transparant \" onclick=\"{savefilterBookmart}\"> Save Filter</button> </div> <div class=\"col-md-6 pd-l-0\"> <button type=\"button\" class=\"btn btn-outline-secondary wd-100-color-transparant \" data-dismiss=\"modal\">Cancel</button> </div> </div> </div> </div> </form> </div> </div> <div id=\"modaldetailmentions\" class=\"modal fade show\"> <div class=\"modal-dialog modal-lg\" role=\"document\" style=\"width: 800px;\"> <div class=\"modal-content tx-size-sm\"> <detaimention ref=\"detailmentions\"></detaimention> </div> </div> </div>',\"\",\"\",(function(t){this.error=!1,this.isExportActive=!1,this.search={since:null,until:null,project:null},this.channels=null,this.on(\"mount\",()=>{this.xhr=null,window.innerWidth>=500&&$(\"#showmax500hidden\").hide(),urlStream.trigger(\"changeUrl\",\"mentions\"),menuActive.trigger(\"activated\",[\"mentions\"]),APP.currentProject=this.search.project=p(\"project\")?p(\"project\"):APP.getProject(),this.xhrdata=null,p(\"filter\")&&this.getfilterlistid(),setTimeout(()=>{const t=this.channels=this.refs.channel.getChannelSelected(),e=Object(s.map)(t,t=>t.id);this.search.service_category=e.join(\",\")},500),p(\"author\")&&this.getAuthor(),$(\"body,html\").animate({scrollTop:0},500)}),this.render=()=>{p(\"valsection\")&&(this.search.section=p(\"valsection\")),null!=this.search.project||null!=this.search.project?this.xhrdata=this.refs.chartstream.render(()=>{this.refs.sentiment.render(),this.refs.streamTimeline.render(),this.setTotal()}):swal(\"Oops...\",\"Create your project\",\"warning\")},this.updateDate=(t,e)=>{p(\"valsince\")?this.search.since=p(\"valsince\"):this.search.since=t,p(\"valuntil\")?this.search.until=p(\"valuntil\"):this.search.until=e,this.refs.streamTimeline.isLoading=!0,this.refs.streamTimeline.total=1,this.refs.channel.isLoading=!0,setTimeout(function(){this.render(),this.update()}.bind(this),1e3)},this.updateChannel=t=>{this.refs.streamTimeline.isLoading=!0,this.channels=t;const e=Object(s.map)(t,t=>t.id);this.search.service_category=e.join(\",\"),this.search.since=localStorage.since,this.search.until=localStorage.until,setTimeout(function(){this.render(),this.update()}.bind(this),100)},this.updateSentiment=t=>{this.refs.streamTimeline.isLoading=!0,this.search.section=t,this.search.since=localStorage.since,this.search.until=localStorage.until,setTimeout(function(){this.render(),this.update()}.bind(this),100)},this.setTotal=()=>{APP.log(\"competitive: setTotal\"),this.refs.channel.updateRenderSentiment()},this.savefilterBookmart=t=>{t.preventDefault(),this.updatenamefilter=this.refs.nameFilterValue.value,this.updatenamefilter?(window.innerWidth>=500?this.refs.filterval.savefilter(t):this.refs.filtervalmobile.savefilter(t),this.update()):(this.error=!0,this.update())},this.updateFilter=()=>{this.refs.streamTimeline.isLoading=!0,this.refs.streamTimeline.query={page:0,limit:this.refs.streamTimeline.query.limit},this.refs.streamTimeline.pagination.page=1,setTimeout(function(){this.render(),this.update()}.bind(this),100)},this.resetFilter=()=>{this.refs.streamTimeline.isLoading=!0,this.refs.streamTimeline.query={page:0,limit:this.refs.streamTimeline.query.limit},this.refs.streamTimeline.pagination.page=1,setTimeout(function(){this.render(),this.update()}.bind(this),100)};this.xhr=renderchart.on(\"chartstream\",(t,e,i,r)=>{$(\"#modaldetailmentions\").modal(\"toggle\"),setTimeout(()=>{Object(s.isEmpty)(this.refs)||(\"hourly\"==r&&this.refs.detailmentions.modalsentimentvalue(t,null,e,null,null,i,null,null,null,null,null,null),\"daily\"==r&&this.refs.detailmentions.modalsentimentvalue(t,null,e,null,null,null,null,null,null,null,null,null),\"monthly\"==r&&this.refs.detailmentions.modalsentimentvalue(t,null,e,null,null,null,null,null,null,null,null,r))},500),this.search.since=t,this.search.until=t,Object(s.isEmpty)(this.refs)||(this.refs.streamTimeline.render(),this.refs.sentiment.render(),this.setTotal())}),this.getfilterlistid=()=>{APP.log(\"project : project\"),APP.apiGet({path:\"bookmark-filter/list/\"+p(\"filter\"),data:{id:p(\"filter\")},success:t=>{this.search.q=t.filter_keywords,this.search.domain=t.filter_domain,this.search.author=t.filter_author,this.search.filterbot=t.filter_filterbot,window.innerWidth>=500?this.refs.filterval.getfilterlist(t):this.refs.filtervalmobile.getfilterlist(t),this.render(),this.update()}})},$(document).ready(()=>{$(\"#maxfollowscroll\").height();var t=null;setTimeout((function(){t=$(\"#follow-scroll\"),$(window).scroll((function(){t.css(\"position\",\"relative\"),$(window).on(\"scroll\",(function(e){var i=$(window).scrollTop();$(window).scrollTop()<$(\"#maxfollowscroll\").height()&&$(window).scrollTop()<$(\"#maxfollowscroll\").height()&&t.stop(!1,!1).animate({top:i<null?0:i-null+60},500)}))}))}),100)}),this.getAuthor=()=>{this.search.author=p(\"author\").replace(/%20/g,\" \"),window.innerWidth>=500?this.refs.filterval.getfilterauthor(p(\"author\").replace(/%20/g,\" \")):this.refs.filtervalmobile.getfilterauthor(p(\"author\").replace(/%20/g,\" \")),this.render()},this.formatLabels=(t,e)=>{let i=[];if(!t||0==t.length)return i;switch(e){case\"since\":i.push({value:moment(t).format(\"YYYY-MM-DD\"),key:e}),i.push({value:moment(t).format(\"HH:mm\"),key:\"since_time\"});break;case\"until\":i.push({value:moment(t).format(\"YYYY-MM-DD\"),key:e}),i.push({value:moment(t).format(\"HH:mm\"),key:\"until_time\"});break;case\"project\":t.forEach(t=>{i.push({key:\"project\",value:String(t)})});break;case\"service_category\":t.forEach(t=>{i.push({key:e,value:t})});break;case\"query\":i.push({key:e,value:t});break;case\"domain\":case\"author\":t.forEach(t=>{i.push({key:e,value:t})});break;case\"type\":i.push({key:e,value:t})}return i},this.downloadStreams=()=>{let t=this;if(this.isExportActive)return;this.isExportActive=!0,this.update();let e={...this.search},i=_.result(localStorage,\"filter_timesince\",\"00:00\"),s=_.result(localStorage,\"filter_timeuntil\",\"59:59\"),r=_.result(e,\"since\",moment().startOf(\"day\").format(\"YYYY-MM-DD\")),a=_.result(e,\"until\",moment().endOf(\"day\").format(\"YYYY-MM-DD\"));if(e.since=moment(`${r} ${i}`),e.until=moment(`${a} ${s}`),\"\"==i&&(e.since=e.since.startOf(\"day\")),\"\"==s&&(e.until=e.until.endOf(\"day\")),!e.since.isValid())return $.notify(\"since invalid date format\",\"error\"),this.exportStreamsLoading(type,!1),void this.update();if(!e.until.isValid())return $.notify(\"until invalid date format\",\"error\"),this.exportStreamsLoading(type,!1),void this.update();e.project=_.result(e,\"project\",\"\").trim().toLowerCase().split(\",\").filter(t=>t).map(t=>Number(t)),e.service_category=_.result(e,\"service_category\",\"\").trim().toLowerCase().split(\",\").filter(t=>t),e.query=_.result(e,\"q\",\"\"),e.domain=_.result(e,\"domain\",\"\").trim().toLowerCase().split(\",\").filter(t=>t),e.author=_.result(e,\"author\",\"\").trim().toLowerCase().split(\",\").filter(t=>t),e.tag=_.result(e,\"taging\",\"\").trim().toLowerCase().split(\",\").filter(t=>t),e.type=\"csv\";let l=[\"since\",\"until\",\"project\",\"service_category\",\"query\",\"domain\",\"author\",\"tag\",\"type\"],o=[];l.forEach(t=>{l.includes(t)&&(o=[...o,...this.formatLabels(e[t],t)])}),o=[...o,{key:\"user_id\",value:localStorage.userid}],delete e.q,APP.apiPost({path:\"task/create\",contentType:\"application/json; charset=utf-8\",data:JSON.stringify({name:`export_stream_raw_${e.since.format(\"YYYY-MM-DD HH:mm\")}_${e.until.format(\"YYYY-MM-DD HH:mm\")}_${e.project.join(\"-\")}`,namespace:\"default\",type:\"export_stream\",description:\"simple task\",chedulerType:0,labels:o,payload:JSON.stringify(e)}),success:function(e){$.notify(\"Download Streams has been scheduled\",\"info\"),APP.apiPut({path:\"task/start\",data:{id:e.result.id,type:\"export_stream\"},success:function(){t.isExportActive=!1,t.update(),$.notify(`starting task export_stream ${e.result.id} sucess`,\"info\")},error:function(){t.isExportActive=!1,t.update(),$.notify(\"starting task failed, please check the background task menu\",\"error\")}})},error:function(){t.isExportActive=!1,t.update(),$.notify(\"Download Streams failed to scheduled\",\"error\")}})},this.doDownload=t=>{window.open(t,\"_blank\")},this.on(\"unmount\",()=>{this.xhrdata&&this.xhrdata.destroy(),this.xhr&&this.xhr.destroy(),localStorage.removeItem(\"Project_devault\")}),$(window).scroll((function(){$(this).scrollTop()>=50?$(\"#return-to-top\").fadeIn(200):$(\"#return-to-top\").fadeOut(200)})),this.scrolltop=()=>{$(\"body,html\").animate({scrollTop:0},500)}}))}}]);","extractedComments":[]}